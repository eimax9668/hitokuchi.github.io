<!DOCTYPE html>
<html lang="ja">
    <head>
        <title>hitokuchi review - send</title>

        <meta charset="utf-8">
        <meta property="og:title" content="hitokuchi review">
        <meta property="og:description" content="hitokuchi(ひとくち)は色々なサービスを展開していきます。">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">

        <link rel="shortcut icon" href="../hitokuchi_logo.webp" type="image/webp">
        <link rel="stylesheet" href="../pagestyle.css">
    </head>
    <body>
        <div id="box">
            <h2>hitokuchi review</h2>
            <a href="../review/index.html">reviewのトップページへ戻る</a> | <a href="watchreview.html">reviewを見る</a>
        </div>
        <br>
        <div id="box">
            URL<br>
            <input type="url" id="send_url" class="text"><br>
            <small>URLは「http(s)://」から書き始めてください</small><br>
            Comment<br>
            <textarea id="area"></textarea><br>
            <button onclick="get_review();">送信する</button>
            <br>
            <small id="states"></small>
        </div>
        <script src="config.js"></script>
        <script>
            const url = key.url;

            async function get_review() {
                const states = document.getElementById("states");
                states.innerHTML = "送信中...";

                let send_url = document.getElementById("send_url").value;

                let comment = document.getElementById("area").value;
                comment = comment.split("&").join("&amp;");
                comment = comment.split("<").join("&lt;"); // &lt;&gt;
                comment = comment.split(">").join("&gt;");
                comment = comment.split("\n").join("<br>");

                if (send_url.match(/https?:\/\/.+/) && comment.trim() != "") {
                    const response = await fetch(
                            url,
                            {
                                method: "POST",
                                body: JSON.stringify({
                                    "request": "SendReview",
                                    "url": send_url,
                                    "comment": comment
                                })
                            }
                        ).then((response) => response.text())
                        .then((data) => JSON.parse(data))
                        .catch((error) => {
                            states.innerHTML = "エラー";
                        });
                    states.innerHTML = "";
                    document.getElementById("send_url").value = "";
                    document.getElementById("area").value = "";
                } else {
                    states.innerHTML = "URLもしくはcommentをちゃんと書いてください"
                }
                
            }
        </script>
    </body>
</html>